import math
import csv
import AeroBDSM
# Глобальные переменные
l_f = 3.906  # длина фюзеляжа м 
M = 0.0
pi = math.pi
D = 0.178  # диаметр миделя, м aka диаметр миделевого сечения корпуса, м
D_I = 0.178  # диаметр корпуса в области передних консолей, м
D_II = 0.178  # диаметр корпуса в области задних консолей, м
bar_D = D / l_f  # относительный диаметр корпуса

l_nos = 0.47  # длина носа м 
l_korm = 0.375  # длина кормы, м  
S_m = (pi * D**2) / 4.0  # площадь миделя , м^2
l_I = 0.484  # размах крыла м 
l_II = 0.5808  # размах руля м

# Коэффициенты интерференции
k_aa_t = (1 + 0.41 * bar_D)**2
K_aa_t = (1 + bar_D)**2

# Для функции get_c_y_alpha_IsP(M, lambda, bar_c, chi_05, zeta):
lambda_val = 0.0  # удлинение несущей поверхности
chi_05 = 0.5  # угол стреловидности по линии середин хорд, рад
bar_c = 0.0  # относительная толщина профиля
zeta = 1  # обратное сужение несущей поверхности

b_kr = 0.1  # Хорда крыла, м
b_op = 0.025  # Хорда оперения, м
l_raszmah = 0.144  # Размах крыла, м
l_raszmah_op = 0.066  # Размах оперения, м

# Площади поверхностей
S_Kons = 4 * 0.03375 * 0.008  # Площадь консолей крыла, м²
S_op = 2 * 0.033 * 0.025  # Площадь оперения, м²

# Расчетные параметры крыльевых поверхностей
l_raszmah_kons = l_raszmah - D  # Размах консоли крыла
lamb = l_raszmah_kons**2 / S_Kons  # Удлинение крыла
lamb_op = l_raszmah_op**2 / (S_op + b_kr**2)  # Удлинение оперения

# Координаты центров давления
xb = 1.262  # Координата центра давления крыла
xb_op = 0.356  # Координата центра давления оперения

# Параметры пограничного слоя
L1 = xb + b_kr / 2.0  # Длина передней части корпуса для крыла
L1_op = xb_op + b_op / 2.0  # Длина передней части корпуса для оперения
L1_bar = L1 / D  # Относительная длина передней части (крыло)
L1_bar_op = L1_op / D  # Относительная длина передней части (оперение)

# Физические константы
nu = 15.1 * 1e-6  # Кинематическая вязкость воздуха
eta_k = 1.0  # Коэффициент полноты корпуса
kappa_M = 0.96  # Поправочный коэффициент для M=2

# Параметры для функций скоса потока
alpha_p = 0.0
phi_alpha = 0.0
psi_I = 0.0
psi_II = 0.0  # Угловые параметры
l_1c_II = 0.036  # Размах одной консоли
zeta_II = 0.0  # Обратное сужение
b_b_II = b_kr  # Длина бортовой хорды  
chi_0_II = 0.0  # Угол стреловидности
L_vI_bII = 0.882  # Расстояние до точки схода вихря

lambda_Nos = 0.5  # Удлинение носовой части
lambda_Cil = 20.1  # Удлинение цилиндрической части

# Параметры для задней части корпуса
L_xv_k = 0.086  # Длина задней части для крыла
L_xv_op = 1.068  # Длина задней части для оперения

# Вспомогательные коэффициенты
Fi_1 = 5.0
Fi_2 = 0.4951
Fi_2_op = 5.0

# Итоговые параметры
S_f = 2.0 * pi * D * (l_f - D / 2.0) + 2.0 * pi * (D / 2.0)**2  # Площадь поверхности фюзеляжа, м²
S = S_op + S_Kons + S_f  # Суммарная площадь
s_f_bar = S_f / S  # Относительная площадь фюзеляжа
s_1_bar = S_op / S  # Относительная площадь оперения  
s_2_bar = S_Kons / S  # Относительная площадь крыла

def save_data_to_csv(x, y, filename):
    """Сохраняет данные в CSV файл"""
    with open(filename, 'w', newline='') as file:
        writer = csv.writer(file)
        writer.writerow(['x', 'y'])
        for i in range(len(x)):
            writer.writerow([x[i], y[i]])

def get_c_y_alpha_NosCil_Con(M, lambda_nos, lambda_cil):
    """
    Заглушка для аэродинамической функции
    В реальном коде здесь должна быть реализация расчета коэффициента подъемной силы
    """
    # Это упрощенная реализация - в реальном коде здесь должен быть сложный расчет
    # основанный на числе Маха и геометрических параметрах
    if M < 1.0:
        c_y_alpha = 2 * math.pi / math.sqrt(1 - M**2)
    else:
        c_y_alpha = 4 / math.sqrt(M**2 - 1)
    
    # Корректировка на геометрические параметры
    c_y_alpha *= (1 + 0.1 * lambda_nos) * (1 + 0.05 * lambda_cil)
    
    return {'ErrorCode': 0, 'Value': c_y_alpha}

def main():
    mach_numbers = []
    lift_coefficients = []

    alpha_deg = 20  # угол атаки 20 градусов
    alpha_rad = alpha_deg * math.pi / 180.0

    # Углы атаки от -10° до 10°
    angles_deg = [-10, -5, 0, 5, 10]

    lambda_Nos = l_nos / D  # удлинение носовой части
    lambda_Cil = l_f / D  # удлинение цилиндрической части 

    # Файл для всех данных
    with open('all_angles_data.csv', 'w', newline='') as file:
        writer = csv.writer(file)
        
        # Заголовок
        header = ['Mach']
        for angle in angles_deg:
            header.append(f'alpha_{angle}')
        writer.writerow(header)

        # Расчет для каждого числа Маха
        for M in [round(i * 0.1, 1) for i in range(5, 41)]:  # от 0.5 до 4.0 с шагом 0.1
            result = get_c_y_alpha_NosCil_Con(M, lambda_Nos, lambda_Cil)

            if result['ErrorCode'] == 0:
                c_y_alpha = result['Value']
                row = [M]

                # C_y для каждого угла атаки
                for angle_deg in angles_deg:
                    angle_rad = angle_deg * math.pi / 180.0
                    c_y = c_y_alpha * angle_rad
                    row.append(c_y)
                
                writer.writerow(row)

    print("Данные созданы!")

if __name__ == "__main__":
    main()